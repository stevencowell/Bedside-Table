<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="description" content="Stage 5 Industrial Technology Timber - Bedside Table Project - 2025" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bedside Table Project</title>
  <style>
    /* General Styles */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f4f4f4;
    }
    a {
      text-decoration: none;
      color: inherit;
      cursor: pointer;
    }
    h1, h2, h3, h4, h5 {
      margin: 0 0 10px 0;
    }
    /* HEADER SECTION STYLES */
    header {
      background: #007bff;
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    header h1 {
      font-size: 2.5em;
    }
    header p {
      font-size: 1.2em;
    }
    /* NAVIGATION STYLES */
    nav {
      display: flex;
      justify-content: center;
      background: #0056b3;
      flex-wrap: wrap;
    }
    nav a {
      padding: 15px 20px;
      color: #fff;
      display: inline-block;
      transition: background 0.3s;
    }
    nav a:hover, nav a.active {
      background: #003f80;
    }
    /* GOOGLE CLASSROOM SECTION STYLES */
    .google-classroom {
      background: #fffbcc;
      padding: 20px;
      text-align: center;
      border: 1px solid #e0e0e0;
      margin: 20px auto;
      width: 90%;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      border-radius: 5px;
    }
    .google-classroom h2 {
      color: #007bff;
    }
    .google-classroom p {
      font-size: 1.1em;
    }
    .google-classroom a {
      display: inline-block;
      background: #007bff;
      color: #fff;
      padding: 10px 20px;
      margin-top: 10px;
      border-radius: 5px;
      font-weight: bold;
      transition: background 0.3s;
    }
    .google-classroom a:hover {
      background: #0056b3;
    }
    /* NEW: Google Image Styles */
    .google-image {
      text-align: center;
      margin: 20px 0;
    }
    .google-image img {
      max-width: 400px;
      width: 100%;
      height: auto;
      border-radius: 5px;
    }
    /* MAIN CONTENT STYLES */
    main.content {
      padding: 20px;
    }
    .content-section {
      display: none; /* Hidden by default; activated via JS */
      background: #fff;
      margin: 10px auto;
      padding: 20px;
      width: 90%;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border-radius: 5px;
    }
    .content-section.active {
      display: block;
    }
    .content-section h2 {
      color: #007bff;
      margin-bottom: 15px;
      border-bottom: 2px solid #f4f4f4;
      padding-bottom: 5px;
    }
    .content-section h3 {
      margin-top: 20px;
      color: #333;
    }
    .content-section h4 {
      margin-top: 15px;
      color: #555;
    }
    .content-section p, .content-section li {
      margin-bottom: 10px;
    }
    .content-section ul, .content-section ol {
      margin: 10px 0 15px 20px;
    }
    .content-section details {
      background: #e9ecef;
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
    }
    .content-section summary {
      cursor: pointer;
      font-size: 1.05em;
    }
    .content-section summary::-webkit-details-marker {
      color: #007bff;
    }
    .content-section details p {
      margin: 5px 0;
    }
    .resource-links ul {
      list-style: none;
      padding: 0;
    }
    .resource-links li {
      margin: 5px 0;
    }
    .resource-links a {
      color: blue;
    }
    /* Styles for quiz feedback */
    .quiz label[data-result="right"] {
        color: green;
        font-weight: bold;
    }
    .quiz label[data-result="wrong"] {
        color: red;
        text-decoration: line-through;
    }
    .quiz-msg {
        display: block;
        margin-top: 10px;
        font-weight: bold;
    }
    /* Style for audio buttons */
    .quiz button[aria-label^="Read"] {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1em;
        padding: 0 5px;
        vertical-align: middle;
    }

    /* Ensure all list texts are bold (except quiz lists) */
    .content-section ul li,
    .content-section ol li,
    .resource-links ul li {
      font-weight: bold;
    }
    /* Keep quiz list items normal weight */
    .quiz li {
      font-weight: normal;
    }
    .resource-links a {
      font-weight: bold;
    }



/* Ensure all summary headings (list links) are bold */
summary { font-weight: bold; }

  

  /* Make all textareas taller & wider */
  textarea { min-height: 140px; width: 95%; max-width: 900px; }
  .wide-textarea { width: 98%; max-width: 1000px; }

    /* Popup box styles */
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .popup-overlay.active {
      display: flex;
    }
    .popup-box {
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      position: relative;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    .popup-box a {
      display: inline-block;
      margin-top: 10px;
      background: #007bff;
      color: #fff;
      padding: 10px 15px;
      border-radius: 4px;
      font-weight: bold;
    }
    .popup-box button:not(.close-popup) {
      display: inline-block;
      margin-top: 10px;
      background: #007bff;
      color: #fff;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    .popup-box button:not(.close-popup):hover {
      background: #0056b3;
    }
    .popup-box button.close-popup {
      background: none;
      border: none;
      position: absolute;
      top: 5px;
      right: 10px;
      font-size: 1.2em;
      cursor: pointer;
    }

</style>

</head>
<body>
<header>
  <h1><b>Stage 5 Industrial Technology Timber - Bedside Table Project</b> - 2025</h1>
  <p>Resources, Projects, and Content for Learning</p>
  <div class="header-image">
    <!-- STAFF: Replace 'sample_project.png' with your project image -->
      <img src="table.png" alt="Bedside Table" style="max-width:300px; width:100%; margin-top:20px; border-radius:5px;" />
    <div class="plan-link" style="margin-top:10px;">
      <!-- STAFF: Update link to your project's plan PDF -->
      <a href="BedsideTablePlan.pdf" style="background:#28a745; color:#fff; padding:10px 15px; border-radius:4px; font-weight:bold; display:inline-block;" target="_blank">Download Project Plan (PDF)</a>
    </div>
  </div>
</header>

<section class="google-classroom" aria-label="Google Classroom Invitation">
  <h2>Join Our Google Classroom</h2>
  <p>Use the code below to join the class and access all online resources:</p>
  <p><strong>Classroom Code: <span style="color:#d9534f; font-size:1.3em;">bedside23</span></strong></p>
  <!-- STAFF: Update the Google Classroom link -->
  <a href="https://classroom.google.com/w/NzQ5MDQxMzk4MjAz/t/all" target="_blank">Join Google Classroom</a>
</section>

<nav aria-label="Main Navigation">
  <a class="nav-link active" data-section="program" href="#program">Subject Program</a>
  <a class="nav-link" data-section="syllabus" href="#syllabus">Syllabus</a>
  <a class="nav-link" data-section="assessment" href="#assessment">Assessments</a>
  <a class="nav-link" data-section="project-unit" href="#project-unit">Bedside Table Project Unit</a>
  <a class="nav-link" data-section="main-theory" href="#main-theory">Main Theory Content</a>
  <a class="nav-link" data-section="support-activities" href="#support-activities">Support Theory Content (Optional)</a>
  <a class="nav-link" data-section="advanced-activities" href="#advanced-activities">Advanced Theory Content (Optional)</a>
</nav>

<main class="content">

<main class="content">
<details>
  <summary><strong>Week 2:</strong> Design, Sketches, Measuring, and Mark-Out</summary>
  <article>
    <h4>Overview</h4>
    <p>This week, you'll build on your understanding of woodworking principles by creating detailed design sketches and accurately measuring and marking out your materials. Precision at this stage ensures successful construction and minimal waste.</p>
    <h4>Design Principles</h4>
    <p>Remember, effective design incorporates:</p>
    <ul>
      <li><b>Balance and Proportion:</b> Ensure your bedside table is aesthetically pleasing and structurally sound.</li>
      <li><b>Functionality:</b> Consider the practical use of your table, including drawer size and shelf space.</li>
      <li><b>Materials:</b> Choose appropriate timber types, considering grain, durability, and appearance.</li>
    </ul>
    <h4>Measuring and Marking Out</h4>
    <p>Accurate measurement and marking are critical:</p>
    <ul>
      <li>Always use sharp pencils or marking knives for clear lines.</li>
      <li>Double-check all measurements before cutting (&quot;measure twice, cut once&quot;).</li>
      <li>Tools such as rulers, try squares, and marking gauges must be correctly used to ensure precision.</li>
    </ul>
    <h4>Practical Activity</h4>
    <ul>
      <li>Sketch your bedside table designs, showing detailed dimensions.</li>
      <li>Clearly label each component.</li>
      <li>Cut timber to length following accurate marking.</li>
    </ul>
    <h4>Resources</h4>
    <div class="resource-links">
      <ul>
        <li><a href="https://www.youtube.com/watch?v=2aMKPELRhAo" target="_blank">Basic Woodworking Measuring Tools and Techniques (YouTube)</a></li>
        <li><a href="https://www.woodmagazine.com/woodworking-how-to/designing-furniture/principles-of-good-furniture-design" target="_blank">Principles of Good Furniture Design</a></li>
      </ul>
    </div>
    <form class="quiz" data-week="2" id="week2-quiz" style="margin-top: 1.5rem;">
      <fieldset>
        <legend><strong>Have you been paying attention? â€“ Week 2 Quiz</strong></legend>
        <ol>
          <li>
            <p>Why is it important to sketch multiple design ideas for your bedside table? <button aria-label="Read question aloud" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></p>
            <label><input name="q1_2" type="radio" value="Finish"/> To quickly finish the assignment <button aria-label="Read answer To quickly finish the assignment" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input data-correct="true" name="q1_2" type="radio" value="Explore"/> To explore different options and select the best design <button aria-label="Read answer To explore different options and select the best design" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q1_2" type="radio" value="Decorate"/> To make sketches for decoration <button aria-label="Read answer To make sketches for decoration" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q1_2" type="radio" value="Fill"/> To fill pages in the folio <button aria-label="Read answer To fill pages in the folio" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label>
          </li>
          <li>
            <p>Ben notices his lines are thick and unclear when marking timber. What should he do? <button aria-label="Read question aloud" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></p>
            <label><input name="q2_2" type="radio" value="Continue"/> Continue working as is <button aria-label="Read answer Continue working as is" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input data-correct="true" name="q2_2" type="radio" value="Sharpen"/> Sharpen his pencil or use a marking knife for clear lines <button aria-label="Read answer Sharpen his pencil or use a marking knife for clear lines" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q2_2" type="radio" value="Darker"/> Use darker pencils <button aria-label="Read answer Use darker pencils" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q2_2" type="radio" value="Ignore"/> Ignore it; measurements will still be fine <button aria-label="Read answer Ignore it; measurements will still be fine" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label>
          </li>
          <li>
            <p>When checking measurements, why should you measure twice before cutting? <button aria-label="Read question aloud" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></p>
            <label><input name="q3_2" type="radio" value="Slow"/> It slows down the work <button aria-label="Read answer It slows down the work" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q3_2" type="radio" value="Rule"/> It is a school rule <button aria-label="Read answer It is a school rule" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input data-correct="true" name="q3_2" type="radio" value="Avoid"/> To avoid mistakes and material wastage <button aria-label="Read answer To avoid mistakes and material wastage" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q3_2" type="radio" value="Practice"/> To practice using the measuring tape <button aria-label="Read answer To practice using the measuring tape" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label>
          </li>
          <li>
            <p>What tool should be used to ensure a line is exactly perpendicular to the edge of the timber? <button aria-label="Read question aloud" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></p>
            <label><input name="q4_2" type="radio" value="Ruler"/> Ruler <button aria-label="Read answer Ruler" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input data-correct="true" name="q4_2" type="radio" value="Square"/> Try square <button aria-label="Read answer Try square" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q4_2" type="radio" value="Tape"/> Measuring tape <button aria-label="Read answer Measuring tape" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q4_2" type="radio" value="Gauge"/> Marking gauge <button aria-label="Read answer Marking gauge" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label>
          </li>
          <li>
            <p>Sarah has created a beautiful design, but it seems unstable. Which design principle needs improvement? <button aria-label="Read question aloud" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></p>
            <label><input name="q5_2" type="radio" value="Colour"/> Colour coordination <button aria-label="Read answer Colour coordination" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input data-correct="true" name="q5_2" type="radio" value="Balance"/> Balance and proportion <button aria-label="Read answer Balance and proportion" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q5_2" type="radio" value="Function"/> Functionality <button aria-label="Read answer Functionality" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q5_2" type="radio" value="Material"/> Material choice <button aria-label="Read answer Material choice" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label>
          </li>
          <li>
            <p>When marking long lengths repeatedly, which tool is most efficient to ensure consistency? <button aria-label="Read question aloud" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></p>
            <label><input data-correct="true" name="q6_2" type="radio" value="Gauge"/> A marking gauge <button aria-label="Read answer A marking gauge" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q6_2" type="radio" value="Pencil"/> A pencil <button aria-label="Read answer A pencil" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q6_2" type="radio" value="Ruler"/> A ruler <button aria-label="Read answer A ruler" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q6_2" type="radio" value="Tape"/> A tape measure <button aria-label="Read answer A tape measure" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label>
          </li>
          <li>
            <p>What is the best practice if you are unsure about a measurement? <button aria-label="Read question aloud" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></p>
            <label><input name="q7_2" type="radio" value="Estimate"/> Estimate and cut <button aria-label="Read answer Estimate and cut" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q7_2" type="radio" value="Peer"/> Ask a peer <button aria-label="Read answer Ask a peer" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input data-correct="true" name="q7_2" type="radio" value="Recheck"/> Recheck and consult your plan or teacher <button aria-label="Read answer Recheck and consult your plan or teacher" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q7_2" type="radio" value="Longer"/> Use a longer piece of timber than needed <button aria-label="Read answer Use a longer piece of timber than needed" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label>
          </li>
          <li>
            <p>Tom notices he has been marking from an angle, creating errors. What is this called? <button aria-label="Read question aloud" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></p>
            <label><input name="q8_2" type="radio" value="Skewing"/> Skewing <button aria-label="Read answer Skewing" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input data-correct="true" name="q8_2" type="radio" value="Parallax"/> Parallax error <button aria-label="Read answer Parallax error" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q8_2" type="radio" value="Offset"/> Offset marking <button aria-label="Read answer Offset marking" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q8_2" type="radio" value="Angular"/> Angular error <button aria-label="Read answer Angular error" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label>
          </li>
          <li>
            <p>Why should you label each component clearly in your sketches? <button aria-label="Read question aloud" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></p>
            <label><input name="q9_2" type="radio" value="Neat"/> Because it looks neat <button aria-label="Read answer Because it looks neat" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input data-correct="true" name="q9_2" type="radio" value="Clarity"/> To ensure clarity during construction and assembly <button aria-label="Read answer To ensure clarity during construction and assembly" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q9_2" type="radio" value="Complex"/> To make sketches appear more complex <button aria-label="Read answer To make sketches appear more complex" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q9_2" type="radio" value="Fulfill"/> To fulfill worksheet requirements <button aria-label="Read answer To fulfill worksheet requirements" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label>
          </li>
          <li>
            <p>What is the first step in marking out your timber? <button aria-label="Read question aloud" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></p>
            <label><input data-correct="true" name="q10_2" type="radio" value="Check"/> Check your plans and measure accurately <button aria-label="Read answer Check your plans and measure accurately" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q10_2" type="radio" value="Cut"/> Start cutting immediately <button aria-label="Read answer Start cutting immediately" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q10_2" type="radio" value="Any"/> Use any pencil available <button aria-label="Read answer Use any pencil available" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label><br/>
            <label><input name="q10_2" type="radio" value="Rough"/> Mark roughly to estimate <button aria-label="Read answer Mark roughly to estimate" onclick="event.preventDefault(); speakText(this)" type="button">ðŸ”Š</button></label>
          </li>
        </ol>
        <button class="check-btn" type="button" onclick="submitQuiz(this, 'bedside-week2')">Check answers</button>
        <span class="quiz-msg" id="week2-quiz-msg"></span>
      </fieldset>
    </form>
    <h4>Conclusion</h4>
    <p>Clear design sketches and careful marking give you the best chance of building a sturdy, accurate project. Measure twice, cut once!</p>
  </article>
</details>
</main>

<!-- Popup for results -->
<div id="resultPopup" class="popup-overlay" role="dialog" aria-modal="true">
  <div class="popup-box">
    <button class="close-popup" aria-label="Close">&times;</button>
    <h3>Results Submitted</h3>
    <p>You can now visit Google Classroom to record your work.</p>
    <!-- STAFF: Replace href with the project link when available -->
    <a id="popupClassroomLink" href="#" target="_blank">Open Google Classroom</a>
  </div>
</div>

<!-- Popup for entering name -->
<div id="namePopup" class="popup-overlay" role="dialog" aria-modal="true">
  <div class="popup-box">
    <label for="studentName"><b>Please enter your name:</b></label><br/>
    <input type="text" id="studentName" style="margin-top:10px; padding:8px; width:95%;" />
    <button id="submitNameBtn" style="margin-top:10px;">Submit</button>
  </div>
</div>

<script>
    // Script for handling navigation link clicks and toggling active sections
    document.addEventListener('DOMContentLoaded', () => {
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.content-section');

        // Function to set the active section based on URL hash or default
        function setActiveSection() {
            let targetID = window.location.hash.substring(1) || 'program';
            if (!document.getElementById(targetID)) {
                targetID = 'program';
            }

            navLinks.forEach(nav => {
                nav.classList.remove('active');
                if (nav.getAttribute('data-section') === targetID) {
                    nav.classList.add('active');
                }
            });
            sections.forEach(sec => {
                sec.classList.remove('active');
                if (sec.id === targetID) {
                    sec.classList.add('active');
                }
            });
        }

        // Set active section on page load
        setActiveSection();

        // Add click event listeners to navigation links
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetID = link.getAttribute('data-section');
                window.location.hash = targetID;

                navLinks.forEach(nav => nav.classList.remove('active'));
                sections.forEach(sec => sec.classList.remove('active'));

                link.classList.add('active');
                const targetSection = document.getElementById(targetID);
                if (targetSection) {
                    targetSection.classList.add('active');
                    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Listen for hash changes (e.g., browser back/forward buttons)
        window.addEventListener('hashchange', setActiveSection);
    });
</script>
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwTomPeDrZ-vDZyEC72wXeoeFpro0Z8zCD2OfgL9HxY7nBsokoieXxy4sT3n_O4x3iqhg/exec";
const CLASSROOM_LINK = "https://classroom.google.com/w/NzQ5MDQxMzk4MjAz/t/all"; // STAFF: Replace with your Google Classroom link

// Voice setup for text-to-speech
const synth = window.speechSynthesis;
let voices = [];
synth.onvoiceschanged = () => { voices = synth.getVoices(); };

function speakText(btn) {
  let text = '';
  if (btn.dataset.text) {
    text = btn.dataset.text;
  } else {
    const p = btn.closest('p');
    if (p) {
      text = Array.from(p.childNodes)
        .filter(n => n.nodeType === Node.TEXT_NODE)
        .map(n => n.textContent.trim())
        .join(' ');
    } else {
      const lbl = btn.closest('label');
      text = Array.from(lbl.childNodes)
        .filter(n => n.nodeType === Node.TEXT_NODE)
        .map(n => n.textContent.trim())
        .filter(t => t.length)
        .join(' ');
    }
  }
  if (!voices.length) voices = synth.getVoices();
  const utt = new SpeechSynthesisUtterance(text);
  utt.voice = voices.find(v => v.name === 'Google UK English Female')
             || voices.find(v => /Natural/.test(v.name))
             || voices[0];
  synth.speak(utt);
}

function showResultPopup(url) {
  const overlay = document.getElementById('resultPopup');
  const link = document.getElementById('popupClassroomLink');
  if (link) link.href = url || '#';
  if (overlay) overlay.classList.add('active');
}

function askForName() {
  return new Promise(resolve => {
    const overlay = document.getElementById('namePopup');
    const input = document.getElementById('studentName');
    const btn = document.getElementById('submitNameBtn');
    if (!overlay || !input || !btn) { resolve(''); return; }
    overlay.classList.add('active');
    btn.onclick = () => {
      const name = input.value.trim();
      if (!name) return;
      overlay.classList.remove('active');
      resolve(name);
    };
  });
}

document.addEventListener('DOMContentLoaded', () => {
  const closeBtn = document.querySelector('#resultPopup .close-popup');
  if (closeBtn) {
    closeBtn.addEventListener('click', () => {
      document.getElementById('resultPopup').classList.remove('active');
    });
  }
});

function submitQuiz(btn, quizType) {
  const form = btn.closest('form');
  const fieldset = form.querySelector('fieldset');
  let correct = 0, total = 0;
  const results = [];
  fieldset.querySelectorAll('li').forEach((li, idx) => {
    const radios = li.querySelectorAll('input[type=radio]');
    let userCorrect = false, answered = false;
    radios.forEach(radio => {
      if (radio.checked) {
        answered = true;
        if (radio.hasAttribute('data-correct')) userCorrect = true;
      }
      // Reset label
      radio.parentElement.removeAttribute('data-result');
    });
    total += 1;
    // Mark right/wrong visually
    radios.forEach(radio => {
      if (radio.checked) {
        radio.parentElement.setAttribute('data-result', userCorrect ? "right" : "wrong");
      }
    });
    if (userCorrect) correct += 1;
    results.push({
      question: li.querySelector('p').textContent,
      answer: Array.from(radios).find(r => r.checked)?.value || ''
    });
  });
  // Show feedback
  let msg = `You got ${correct} out of ${total} correct.`;
  form.querySelector('.quiz-msg').textContent = msg;

  askForName().then(name => {
    fetch(SCRIPT_URL, {
      method: "POST",
      mode: "cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        quizType,
        quiz: results,
        score: correct + "/" + total,
        studentName: name,
        timestamp: new Date().toISOString()
      })
    });
    showResultPopup(CLASSROOM_LINK);
  });
}

function submitAdvancedQuiz(btn, quizType) {
  const form = btn.closest('form');
  const textareas = form.querySelectorAll('textarea');
  const responses = [];
  textareas.forEach((ta) => {
    responses.push({
      question: ta.closest('li').querySelector('p').textContent,
      answer: ta.value.trim()
    });
  });

  const studentName = prompt('Please enter your name to submit your answers:');
  if (!studentName) return;

  form.querySelector('.quiz-msg').textContent =
    'Responses submitted. Your teacher will review them.';

  fetch(SCRIPT_URL, {
    method: 'POST',
    mode: 'cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      quizType,
      studentName: studentName.trim(),
      responses,
      timestamp: new Date().toISOString()
    })
  });
  showResultPopup(CLASSROOM_LINK);
}
</script>
</body>
</html>
